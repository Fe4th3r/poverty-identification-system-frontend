{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = [\"onClick\"];\nconst _hoisted_2 = [\"onClick\"];\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = [\"onClick\"];\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  key: 0\n};\nconst _hoisted_7 = {\n  key: 1\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_StudentForm = _resolveComponent(\"StudentForm\");\n  const _component_FamilyInfoForm = _resolveComponent(\"FamilyInfoForm\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_cache[4] || (_cache[4] = _createElementVNode(\"h2\", null, \"学生信息列表\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.showAddForm && $options.showAddForm(...args))\n  }, \"添加学生\"), _cache[5] || (_cache[5] = _createElementVNode(\"br\", null, null, -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.searchName = $event),\n    placeholder: \"输入姓名搜索\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.searchName]]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.searchStudents && $options.searchStudents(...args))\n  }, \"搜索\"), _createElementVNode(\"table\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"ID\"), _createElementVNode(\"th\", null, \"学号\"), _createElementVNode(\"th\", null, \"姓名\"), _createElementVNode(\"th\", null, \"性别\"), _createElementVNode(\"th\", null, \"身份证号\"), _createElementVNode(\"th\", null, \"专业\"), _createElementVNode(\"th\", null, \"操作\"), _createElementVNode(\"th\", null, \"家庭信息操作\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.students, student => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: student.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(student.id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(student.stuId), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(student.name), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(student.gender), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(student.idCard), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(student.major), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"button\", {\n      onClick: $event => $options.showEditForm(student)\n    }, \"编辑\", 8 /* PROPS */, _hoisted_1), _createElementVNode(\"button\", {\n      onClick: $event => $options.deleteStudent(student.id)\n    }, \"删除\", 8 /* PROPS */, _hoisted_2)]), _createElementVNode(\"td\", null, [!$options.hasFamilyInfo(student) ? (_openBlock(), _createElementBlock(\"button\", {\n      key: 0,\n      onClick: $event => $options.showAddFamilyInfoForm(student.id)\n    }, \"添加家庭信息\", 8 /* PROPS */, _hoisted_3)) : (_openBlock(), _createElementBlock(\"button\", {\n      key: 1,\n      onClick: $event => $options.showEditFamilyInfoForm(student)\n    }, \"编辑家庭信息\", 8 /* PROPS */, _hoisted_4)), $options.hasFamilyInfo(student) ? (_openBlock(), _createElementBlock(\"button\", {\n      key: 2,\n      onClick: $event => $options.deleteFamilyInfo(student.id)\n    }, \"删除家庭信息\", 8 /* PROPS */, _hoisted_5)) : _createCommentVNode(\"v-if\", true)])]);\n  }), 128 /* KEYED_FRAGMENT */))])]), $data.showForm ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createVNode(_component_StudentForm, {\n    student: $data.currentStudent,\n    onSave: $options.handleSave,\n    onCancel: $options.resetForm\n  }, null, 8 /* PROPS */, [\"student\", \"onSave\", \"onCancel\"])])) : _createCommentVNode(\"v-if\", true), $data.showFamilyForm ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_createVNode(_component_FamilyInfoForm, {\n    studentId: $data.currentStudentId,\n    familyInfo: $data.currentFamilyInfo,\n    onSave: $options.handleFamilyInfoSave,\n    onCancel: $options.resetFamilyForm\n  }, null, 8 /* PROPS */, [\"studentId\", \"familyInfo\", \"onSave\", \"onCancel\"])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["key","_createElementBlock","_createElementVNode","onClick","_cache","args","$options","showAddForm","type","$event","$data","searchName","placeholder","searchStudents","_Fragment","_renderList","students","student","id","_toDisplayString","stuId","name","gender","idCard","major","showEditForm","_hoisted_1","deleteStudent","_hoisted_2","hasFamilyInfo","showAddFamilyInfoForm","_hoisted_3","showEditFamilyInfoForm","_hoisted_4","deleteFamilyInfo","_hoisted_5","_createCommentVNode","showForm","_hoisted_6","_createVNode","_component_StudentForm","currentStudent","onSave","handleSave","onCancel","resetForm","showFamilyForm","_hoisted_7","_component_FamilyInfoForm","studentId","currentStudentId","familyInfo","currentFamilyInfo","handleFamilyInfoSave","resetFamilyForm"],"sources":["C:\\Users\\Administrator\\poverty-identification-system-frontend\\src\\components\\student\\StudentList.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <h2>学生信息列表</h2>\r\n      <button @click=\"showAddForm\">添加学生</button>\r\n      <br/>\r\n      <input type=\"text\" v-model=\"searchName\" placeholder=\"输入姓名搜索\" />\r\n      <button @click=\"searchStudents\">搜索</button>\r\n  \r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>学号</th>\r\n            <th>姓名</th>\r\n            <th>性别</th>\r\n            <th>身份证号</th>\r\n            <th>专业</th>\r\n            <th>操作</th>\r\n            <th>家庭信息操作</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"student in students\" :key=\"student.id\">\r\n            <td>{{ student.id }}</td>\r\n            <td>{{ student.stuId }}</td>\r\n            <td>{{ student.name }}</td>\r\n            <td>{{ student.gender }}</td>\r\n            <td>{{ student.idCard }}</td>\r\n            <td>{{ student.major }}</td>\r\n            <td>\r\n              <button @click=\"showEditForm(student)\">编辑</button>\r\n              <button @click=\"deleteStudent(student.id)\">删除</button>\r\n            </td>\r\n            <td>\r\n              <button v-if=\"!hasFamilyInfo(student)\" @click=\"showAddFamilyInfoForm(student.id)\">添加家庭信息</button>\r\n              <button v-else @click=\"showEditFamilyInfoForm(student)\">编辑家庭信息</button>\r\n              <button v-if=\"hasFamilyInfo(student)\" @click=\"deleteFamilyInfo(student.id)\">删除家庭信息</button>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n  \r\n      <div v-if=\"showForm\">\r\n        <StudentForm :student=\"currentStudent\" @save=\"handleSave\" @cancel=\"resetForm\" />\r\n      </div>\r\n      <div v-if=\"showFamilyForm\">\r\n        <FamilyInfoForm :studentId=\"currentStudentId\" :familyInfo=\"currentFamilyInfo\" @save=\"handleFamilyInfoSave\" @cancel=\"resetFamilyForm\" />\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import axios from 'axios';\r\n  import StudentForm from './StudentForm.vue';\r\n  import FamilyInfoForm from '../family/FamilyInfoForm.vue';\r\n  \r\n  export default {\r\n    name: 'StudentList',\r\n    components: {\r\n      StudentForm,\r\n      FamilyInfoForm\r\n    },\r\n    data() {\r\n      return {\r\n        students: [],\r\n        searchName: '',\r\n        showForm: false,\r\n        showFamilyForm: false,\r\n        currentStudent: null,\r\n        currentStudentId: null,\r\n        currentFamilyInfo: null,\r\n      };\r\n    },\r\n    mounted() {\r\n      this.fetchStudents();\r\n    },\r\n    methods: {\r\n      async fetchStudents() {\r\n        try {\r\n          const response = await axios.get('/api/student');\r\n          this.students = response.data;\r\n        } catch (error) {\r\n          console.error('获取学生信息失败:', error);\r\n        }\r\n      },\r\n      async searchStudents() {\r\n        try {\r\n          const response = await axios.get('/api/student/search', {\r\n            params: {\r\n              name: this.searchName,\r\n            },\r\n          });\r\n          this.students = response.data;\r\n        } catch (error) {\r\n          console.error('搜索学生信息失败:', error);\r\n        }\r\n      },\r\n      showAddForm() {\r\n        this.currentStudent = null;\r\n        this.showForm = true;\r\n      },\r\n      showEditForm(student) {\r\n        this.currentStudent = { ...student }; // 复制一份，避免直接修改原数据\r\n        this.showForm = true;\r\n      },\r\n      async deleteStudent(id) {\r\n        if (confirm('确定要删除该学生信息吗？')) {\r\n          try {\r\n            await axios.delete(`/api/student/${id}`);\r\n            this.fetchStudents(); // 删除后重新加载列表\r\n          } catch (error) {\r\n            console.error('删除学生信息失败:', error);\r\n          }\r\n        }\r\n      },\r\n      handleSave(studentData) {\r\n        if (studentData.id) {\r\n          // 编辑\r\n          this.updateStudent(studentData);\r\n        } else {\r\n          // 添加\r\n          this.addStudent(studentData);\r\n        }\r\n      },\r\n      async addStudent(studentData) {\r\n        try {\r\n          const response = await axios.post('/api/student', studentData);\r\n          if (response.status === 200) {\r\n            this.fetchStudents(); // 添加后重新加载列表\r\n            this.resetForm();\r\n          } else {\r\n            alert(response.data.message); // 显示错误信息\r\n          }\r\n        } catch (error) {\r\n          console.error('添加学生信息失败:', error);\r\n          alert('添加失败');\r\n        }\r\n      },\r\n      async updateStudent(studentData) {\r\n        try {\r\n          const response = await axios.put(`/api/student/${studentData.id}`, studentData);\r\n          if (response.status === 200) {\r\n            this.fetchStudents(); // 更新后重新加载列表\r\n            this.resetForm();\r\n          } else {\r\n            alert(response.data.message);\r\n          }\r\n        } catch (error) {\r\n          console.error('更新学生信息失败:', error);\r\n          alert('更新失败');\r\n        }\r\n      },\r\n      resetForm() {\r\n        this.showForm = false;\r\n        this.currentStudent = null;\r\n      },\r\n      // 新增的家庭信息相关方法\r\n      hasFamilyInfo(student) {\r\n        return student.familyInfo !== null;\r\n      },\r\n      showAddFamilyInfoForm(studentId) {\r\n        this.currentStudentId = studentId;\r\n        this.currentFamilyInfo = null;\r\n        this.showFamilyForm = true;\r\n      },\r\n      async showEditFamilyInfoForm(student) {\r\n        this.currentStudentId = student.id;\r\n        // 获取家庭信息\r\n        try {\r\n          const response = await axios.get(`/api/family-info/${student.id}`);\r\n          this.currentFamilyInfo = response.data;\r\n        } catch (error) {\r\n          console.error(\"获取家庭信息失败:\", error);\r\n          this.currentFamilyInfo = null; // 获取失败也要重置\r\n        }\r\n        this.showFamilyForm = true;\r\n      },\r\n      async deleteFamilyInfo(studentId) {\r\n        if (confirm('确定要删除该学生的家庭信息吗？')) {\r\n          try {\r\n            await axios.delete(`/api/family-info/${studentId}`);\r\n            this.fetchStudents(); // 重新加载学生列表\r\n          } catch (error) {\r\n            console.error('删除家庭信息失败:', error);\r\n          }\r\n        }\r\n      },\r\n      async handleFamilyInfoSave({ studentId, familyInfo }) {\r\n        if (this.currentFamilyInfo && this.currentFamilyInfo.id) {\r\n          // 编辑\r\n          try {\r\n            const response = await axios.put(`/api/family-info/${studentId}`, familyInfo);\r\n            if (response.status === 200) {\r\n              this.fetchStudents(); // 重新加载学生列表\r\n              this.resetFamilyForm();\r\n            } else {\r\n              alert(response.data.message);\r\n            }\r\n          } catch (error) {\r\n            console.error('更新家庭信息失败:', error);\r\n            alert('更新失败');\r\n          }\r\n        } else {\r\n          // 添加\r\n          try {\r\n            const response = await axios.post(`/api/family-info/${studentId}`, familyInfo);\r\n            if (response.status === 200) {\r\n              this.fetchStudents(); // 重新加载学生列表\r\n              this.resetFamilyForm();\r\n            } else {\r\n              alert(response.data.message);\r\n            }\r\n          } catch (error) {\r\n            console.error('添加家庭信息失败:', error);\r\n            alert('添加失败');\r\n          }\r\n        }\r\n      },\r\n      resetFamilyForm() {\r\n        this.showFamilyForm = false;\r\n        this.currentStudentId = null;\r\n        this.currentFamilyInfo = null;\r\n      },\r\n      showSpecialGroupList(studentId) {\r\n      this.currentStudentId = studentId;\r\n      this.showSpecialGroup = true;\r\n    },\r\n    async deleteSpecialGroup(id) {\r\n      if (confirm('确定要删除该学生的特殊群体信息吗？')) {\r\n        try {\r\n          await axios.delete(`/api/special-group/${id}`);\r\n          this.fetchStudents(); // 重新加载学生列表\r\n        } catch (error) {\r\n          console.error('删除特殊群体信息失败:', error);\r\n        }\r\n      }\r\n    },\r\n        resetSpecialGroupList() {\r\n         this.showSpecialGroup = false;\r\n         this.currentStudentId = null;\r\n        },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  /* 样式保持不变 */\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}