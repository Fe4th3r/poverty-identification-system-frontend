{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 1\n};\nconst _hoisted_2 = [\"onClick\"];\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = {\n  key: 2\n};\nconst _hoisted_5 = {\n  key: 3\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_EmergencyForm = _resolveComponent(\"EmergencyForm\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_cache[2] || (_cache[2] = _createElementVNode(\"h4\", null, \"突发状况信息\", -1 /* HOISTED */)), !$data.showForm ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.showAddForm && $options.showAddForm(...args))\n  }, \"添加突发状况信息\")) : _createCommentVNode(\"v-if\", true), $data.emergencies.length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_1, [_cache[1] || (_cache[1] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"ID\"), _createElementVNode(\"th\", null, \"突发状况描述\"), _createElementVNode(\"th\", null, \"发生日期\"), _createElementVNode(\"th\", null, \"操作\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.emergencies, emergency => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: emergency.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(emergency.id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(emergency.description), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString($options.formatDate(emergency.occurrenceDate)), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"button\", {\n      onClick: $event => $options.showEditForm(emergency)\n    }, \"编辑\", 8 /* PROPS */, _hoisted_2), _createElementVNode(\"button\", {\n      onClick: $event => $options.deleteEmergency(emergency.id)\n    }, \"删除\", 8 /* PROPS */, _hoisted_3)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : !$data.showForm ? (_openBlock(), _createElementBlock(\"p\", _hoisted_4, \"暂无突发状况信息\")) : _createCommentVNode(\"v-if\", true), $data.showForm ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_EmergencyForm, {\n    studentId: $props.studentId,\n    emergency: $data.currentEmergency,\n    onSave: $options.handleSave,\n    onCancel: $options.resetForm\n  }, null, 8 /* PROPS */, [\"studentId\", \"emergency\", \"onSave\", \"onCancel\"])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["key","_createElementBlock","_createElementVNode","$data","showForm","onClick","_cache","args","$options","showAddForm","_createCommentVNode","emergencies","length","_hoisted_1","_Fragment","_renderList","emergency","id","_toDisplayString","description","formatDate","occurrenceDate","$event","showEditForm","_hoisted_2","deleteEmergency","_hoisted_3","_hoisted_4","_hoisted_5","_createVNode","_component_EmergencyForm","studentId","$props","currentEmergency","onSave","handleSave","onCancel","resetForm"],"sources":["C:\\Users\\Administrator\\poverty-identification-system-frontend\\src\\components\\emergency\\EmergencyList.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <h4>突发状况信息</h4>\r\n      <button v-if=\"!showForm\" @click=\"showAddForm\">添加突发状况信息</button>\r\n  \r\n      <table v-if=\"emergencies.length > 0\">\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>突发状况描述</th>\r\n            <th>发生日期</th>\r\n            <th>操作</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"emergency in emergencies\" :key=\"emergency.id\">\r\n            <td>{{ emergency.id }}</td>\r\n            <td>{{ emergency.description }}</td>\r\n            <td>{{ formatDate(emergency.occurrenceDate) }}</td>\r\n            <td>\r\n              <button @click=\"showEditForm(emergency)\">编辑</button>\r\n              <button @click=\"deleteEmergency(emergency.id)\">删除</button>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <p v-else-if=\"!showForm\">暂无突发状况信息</p>\r\n  \r\n      <div v-if=\"showForm\">\r\n        <EmergencyForm :studentId=\"studentId\" :emergency=\"currentEmergency\" @save=\"handleSave\" @cancel=\"resetForm\" />\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import EmergencyForm from './EmergencyForm.vue';\r\n  import axios from 'axios';\r\n  \r\n  export default {\r\n    name: 'EmergencyList',\r\n    components: {\r\n      EmergencyForm,\r\n    },\r\n    props: {\r\n      studentId: {\r\n        type: Number,\r\n        required: true,\r\n      },\r\n    },\r\n    data() {\r\n      return {\r\n        emergencies: [],\r\n        showForm: false,\r\n        currentEmergency: null,\r\n      };\r\n    },\r\n    mounted() {\r\n      this.fetchEmergencies();\r\n    },\r\n    methods: {\r\n      async fetchEmergencies() {\r\n        try {\r\n          const response = await axios.get(`/emergency/${this.studentId}`);\r\n          this.emergencies = response.data;\r\n        } catch (error) {\r\n          console.error('获取突发状况信息失败:', error);\r\n        }\r\n      },\r\n      showAddForm() {\r\n        this.currentEmergency = null;\r\n        this.showForm = true;\r\n      },\r\n      showEditForm(emergency) {\r\n        this.currentEmergency = { ...emergency };\r\n        this.showForm = true;\r\n      },\r\n      async handleSave({ studentId, emergency }) {\r\n        if (this.currentEmergency && this.currentEmergency.id) {\r\n          // 编辑\r\n          try {\r\n            const response = await axios.put(`/emergency/${emergency.id}`, emergency);\r\n            if (response.status === 200) {\r\n              this.fetchEmergencies();\r\n              this.resetForm();\r\n            } else {\r\n              alert(response.data.message);\r\n            }\r\n          } catch (error) {\r\n            console.error('更新突发状况信息失败:', error);\r\n            alert('更新失败');\r\n          }\r\n        } else {\r\n          // 添加\r\n          try {\r\n            const response = await axios.post(`/emergency/${studentId}`, emergency);\r\n            if (response.status === 200) {\r\n              this.fetchEmergencies();\r\n              this.resetForm();\r\n            } else {\r\n              alert(response.data.message);\r\n            }\r\n          } catch (error) {\r\n            console.error('添加突发状况信息失败:', error);\r\n            alert('添加失败');\r\n          }\r\n        }\r\n      },\r\n      async deleteEmergency(id) {\r\n        if (confirm('确定要删除该突发状况信息吗？')) {\r\n          try {\r\n            await axios.delete(`/emergency/${id}`);\r\n            this.fetchEmergencies();\r\n          } catch (error) {\r\n            console.error('删除突发状况信息失败:', error);\r\n          }\r\n        }\r\n      },\r\n      resetForm() {\r\n        this.showForm = false;\r\n        this.currentEmergency = null;\r\n      },\r\n      formatDate(dateString) {\r\n        if (!dateString) return '';\r\n        const date = new Date(dateString);\r\n        return date.toISOString().split('T')[0];\r\n      },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  /* 可以根据需要添加样式 */\r\n  </style>"],"mappings":";;EAAAA,GAAA;AAAA;mBAAA;mBAAA;;EAAAA,GAAA;AAAA;;EAAAA,GAAA;AAAA;;;uBACIC,mBAAA,CA8BM,c,0BA7BJC,mBAAA,CAAe,YAAX,QAAM,sB,CACKC,KAAA,CAAAC,QAAQ,I,cAAvBH,mBAAA,CAA+D;IAHrED,GAAA;IAGgCK,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,WAAA,IAAAD,QAAA,CAAAC,WAAA,IAAAF,IAAA,CAAW;KAAE,UAAQ,KAH5DG,mBAAA,gBAKmBP,KAAA,CAAAQ,WAAW,CAACC,MAAM,Q,cAA/BX,mBAAA,CAoBQ,SAzBdY,UAAA,G,0BAMQX,mBAAA,CAOQ,gBANNA,mBAAA,CAKK,aAJHA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAe,YAAX,QAAM,GACVA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAW,YAAP,IAAE,E,wBAGVA,mBAAA,CAUQ,iB,kBATND,mBAAA,CAQKa,SAAA,QAvBfC,WAAA,CAekCZ,KAAA,CAAAQ,WAAW,EAAxBK,SAAS;yBAApBf,mBAAA,CAQK;MARiCD,GAAG,EAAEgB,SAAS,CAACC;QACnDf,mBAAA,CAA2B,YAAAgB,gBAAA,CAApBF,SAAS,CAACC,EAAE,kBACnBf,mBAAA,CAAoC,YAAAgB,gBAAA,CAA7BF,SAAS,CAACG,WAAW,kBAC5BjB,mBAAA,CAAmD,YAAAgB,gBAAA,CAA5CV,QAAA,CAAAY,UAAU,CAACJ,SAAS,CAACK,cAAc,mBAC1CnB,mBAAA,CAGK,aAFHA,mBAAA,CAAoD;MAA3CG,OAAK,EAAAiB,MAAA,IAAEd,QAAA,CAAAe,YAAY,CAACP,SAAS;OAAG,IAAE,iBApBzDQ,UAAA,GAqBctB,mBAAA,CAA0D;MAAjDG,OAAK,EAAAiB,MAAA,IAAEd,QAAA,CAAAiB,eAAe,CAACT,SAAS,CAACC,EAAE;OAAG,IAAE,iBArB/DS,UAAA,E;yCA0BqBvB,KAAA,CAAAC,QAAQ,I,cAAvBH,mBAAA,CAAqC,KA1B3C0B,UAAA,EA0B+B,UAAQ,KA1BvCjB,mBAAA,gBA4BiBP,KAAA,CAAAC,QAAQ,I,cAAnBH,mBAAA,CAEM,OA9BZ2B,UAAA,GA6BQC,YAAA,CAA6GC,wBAAA;IAA7FC,SAAS,EAAEC,MAAA,CAAAD,SAAS;IAAGf,SAAS,EAAEb,KAAA,CAAA8B,gBAAgB;IAAGC,MAAI,EAAE1B,QAAA,CAAA2B,UAAU;IAAGC,QAAM,EAAE5B,QAAA,CAAA6B;iFA7BxG3B,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}